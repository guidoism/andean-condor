# cd 2023-01-18.andean-condor
# cd ergogen
# npm install
# node src/cli.js ../andean-condor/andean-condor.yaml -o ../andean-condor/ergogen-output
points:
  zones:
    matrix:
      anchor:
        rotate: 5
        shift: [100, -100]
      key:
        tags: [switchcore]
      columns:
        farpinky.key:
          col_net: col1
        pinky.key:
          col_net: col2
        ring.key:
          stagger: 12
          col_net: col3
        middle.key:
          stagger: 5
          col_net: col4
        index.key:
          stagger: -6
          col_net: col5
        inner.key:
          stagger: -2
          col_net: col6
      rows:
        bottom.row_net: row3
        home.row_net: row2
        top.row_net: row1
    thumbfan:
      key:
        tags: [thumbfan]
      anchor:
        ref: matrix_middle_bottom
        shift: [5.5, -25]
      columns:
        tucky.rows.top: $unset
        near.rows.top: $unset
        tucky.key:
          splay: -5
          col_net: col1
        near.key:
          splay: -15
          origin: [-9.5, -9.5]
          col_net: col2
        home.key:
          splay: -15
          origin: [-9.5, -9.5]
          col_net: col3
        far.key:
          splay: -15
          origin: [-9.5, -9.5]
          col_net: col4
      rows:
        thumb.key.row_net: row4
        top.key.row_net: row4
    mcu:
      anchor:
        ref: matrix_inner_top
      columns:
        mcu:
          key:
            tags: [mcu]
            width: 18
            height: 34
            rotate: -75
            shift: [33, -34/2]            
            asym: left
            #skip: true
  rotate: -20
  mirror:
    ref: thumbfan_far_top
    distance: 25
    # row_net: P6

    
outlines:
  outline:
    main:
      what: rectangle
      where: /.*matrix.*|thumbfan|mirror_thumbfan.*/
      size: 20
      fillet: 2
    center:
      what: rectangle
      where: /.*mcu.*/
      size: 50
      fillet: 2
    inbetweenstuff:
      what: polygon
      points:
        - ref: matrix_inner_top
          shift: [$default_width/2,$default_height/2]
        - ref: thumbfan_tucky_thumb
          shift: [$default_width/2,$default_height/2]
        - ref: thumbfan_tucky_thumb
          shift: [$default_width/2,-$default_height/2]
        - ref: thumbfan_near_thumb
          shift: [0,-$default_height/2]
        - ref: thumbfan_home_thumb
          shift: [0,-$default_height/2]
        - ref: thumbfan_far_thumb
          shift: [$default_width/2,-$default_height/2]
        - ref: thumbfan_far_top
          shift: [$default_width/2,$default_height/2]
        - ref: mirror_thumbfan_far_thumb
          shift: [$default_width/2,-$default_height/2]
        - ref: mirror_thumbfan_home_thumb
          shift: [0,-$default_height/2]
        - ref: mirror_thumbfan_near_thumb
          shift: [0,-$default_height/2]
        - ref: mirror_thumbfan_tucky_thumb
          shift: [$default_width/2,-$default_height/2]
        - ref: mirror_thumbfan_tucky_thumb
          shift: [$default_width/2,$default_height/2]
        - ref: mirror_matrix_inner_top
          shift: [$default_width/2,$default_height/2]
  plate:
    - what: outline
      name: outline
pcbs:
  andean-condor:
    footprints:
      mx:
        what: mx
        where: [switchcore, thumbfan]
        params:
          from: "{{colrow}}"
          to: "{{col_net}}"
          keycaps: true
      diodecore:
        what: diode
        where: [switchcore]
        adjust:
          rotate: 90
          shift: [9.5, 0]        
        params:
          from: "{{colrow}}"
          to: "{{row_net}}"
      diodethumbs:
        what: diode
        where: [thumbfan]
        adjust:
          rotate: 0
          shift: [0, 9.5]        
        params:
          from: "{{colrow}}"
          to: "{{row_net}}"
      nicenano:
        what: nicenano
        where:
          ref.aggregate.parts: [matrix_inner_top, mirror_matrix_inner_top]
          rotate: -90
          shift: [0, -10]
        params:
          orientation: down
          RAW: RAW_P1
          GND1: GND_P0
          RST: RST_GND
          VCC: VCC_GND 
          P21: ENCA
          P20: ENCB
          P19: row0
          P18: row1
          P15: row2
          P14: row3
          P16: row4
          P10: row5
          P1: P1_RAW
          P0: P0_GND
          GND2: GND_RST
          GND3: GND_VCC
          P2: SDA
          P3: SCL
          P4: CS
          P5: col0
          P6: col1
          P7: col2
          P8: col3
          P9: col4
      niceview:
        what: niceview
        where: 
          ref.aggregate.parts: [matrix_inner_top, mirror_matrix_inner_top]
          rotate: -90
          shift: [0, -10]
        adjust:
          shift: [20.5, 0]
          rotate: 180
        params:
          outline: true
          side: 'F'
          SDA: NN_SDA_CS
          SCL: NN_SCL_GND
          VCC: NN_VCC
          GND: NN_GND_SCL
          CS: NN_CS_SDA
      slider:
        what: slider
        where: mcu
        adjust:
          shift: [-17.1, 0]
          rotate: 90
        params:
          side: F
          from: switch_from
          to: RAW
      battery:
        what: battery
        where: mcu
        adjust:
          shift: [-17, 0]
        params:
          RAW: switch_from
